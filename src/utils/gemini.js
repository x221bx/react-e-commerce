// src/utils/gemini.js
import { GoogleGenerativeAI } from "@google/generative-ai";

const genAI = new GoogleGenerativeAI("REDACTED");

const model = genAI.getGenerativeModel({
  model: "gemini-2.5-flash", // ุบููุฑ ูู "gemini-1.5-pro-latest" ูู ุนุงูุฒ ููุฉ ุฃูุจุฑ (ูุณู ูุฌุงูู)
  generationConfig: {
    temperature: 0.7,
    topP: 0.95,
    topK: 40,
    maxOutputTokens: 8192,
    responseMimeType: "text/plain",
  },
});

export const analyzeWithGemini = async (firebaseData, customPrompt = null) => {
  const defaultPrompt = `
ุฃูุช ุฎุจูุฑ ุชุญููู ุจูุงูุงุช ููุญูู ุฃุนูุงู ูุชูุฏู ูุจุชุชููู ุนุฑุจู ููุชุงุฒ.

ุงูุจูุงูุงุช ุฏู ุฌุงูุฉ ูู Firebase ุฏูููุชู:
${JSON.stringify(firebaseData, null, 2)}

ุงุนูู ุชุญููู ุฐูู ููุชูุฏู ุจุงูุนุฑุจู ุงููุตุญู ููููู ููู:

## ๐ ุงูููุฎุต ุงูุชูููุฐู
- ูุธุฑุฉ ุณุฑูุนุฉ ุนูู ุงูุฃุฏุงุก ุงูุญุงูู ูู 3-4 ุฌูู
- ุฃูู ุงูููุงุท ุงููู ุชุญุชุงุฌ ุงูุชุจุงู ููุฑู

## ๐ ุงูุชุญููู ุงูุชูุตููู
### ุฅุญุตุงุฆูุงุช ุฃุณุงุณูุฉ:
- ุฅุฌูุงูู ุงูุทูุจุงุช ูุงูููุชุฌุงุช ูุงููุณุชุฎุฏููู
- ุฅุฌูุงูู ุงููุจูุนุงุช ูุงููุชูุณุท
- ุฃุนูู ุงูููุชุฌุงุช ูุจูุนุงู
- ุฃูุซุฑ ุงูุนููุงุก ุดุฑุงุกุงู

### ุฃููุงุท ูุงุชุฌุงูุงุช:
- ุชุญููู ุณููู ุงูุนููุงุก
- ุงูุชููุจุงุช ุงูููุณููุฉ
- ุงูููุชุฌุงุช ุจุทูุฆุฉ ุงูุญุฑูุฉ
- ููุงุท ุงูููุฉ ูุงูุถุนู

## โ๏ธ ุงูุชุญุฐูุฑุงุช ุงููููุฉ
- ููุชุฌุงุช ูุฑูุจุฉ ูู ุงูููุงุฏ
- ุฃููุงุท ูุดุจููุฉ ูู ุงูุทูุจุงุช
- ูุดุงูู ูุญุชููุฉ ูู ุงููุฎุฒูู

## ๐ฏ ุงูุชูุตูุงุช ุงูุฐููุฉ
5 ุชูุตูุงุช ุนูููุฉ ููุญุฏุฏุฉ:
1. ูุฑุงุฑุงุช ููุฑูุฉ (ุฎูุงู 24 ุณุงุนุฉ)
2. ุชุญุณููุงุช ูุชูุณุทุฉ ุงููุฏู (ุฃุณุจูุน)
3. ุงุณุชุฑุงุชูุฌูุงุช ุทูููุฉ ุงููุฏู (ุดูุฑ)

## ๐ ุฎุทุฉ ุนูู ููุชุฑุญุฉ
ุฎุทูุงุช ูุญุฏุฏุฉ ููุฌุฏููุฉ ุจุชูููุฐ ุนููู

ุงุณุชุฎุฏู:
- ุฌุฏุงูู Markdown ููุจูุงูุงุช ุงููุซูุฑุฉ
- Emojis ูุชุณููู ุงููุฑุงุกุฉ
- ุชูุณูู ุฌููู ูููุธู
- ุฃุฑูุงู ูุญุฏุฏุฉ ูููุณุช ุนุงูุฉ
`;

  try {
    const result = await model.generateContent(customPrompt || defaultPrompt);
    const response = await result.response;
    const text = response.text();
    return text;
  } catch (error) {
    console.error("ุฎุทุฃ ูู Gemini:", error);

    
    return `ุนุฐุฑุงูุ ุญุตู ูุดููุฉ ูู ุงูุงุชุตุงู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู.\nุงูุชูุงุตูู: ${error.message}\n\nุฌุฑุจ ุชุงูู ุจุนุฏ ุดููุฉ ุฃู ุชุฃูุฏ ุฅู ุงููุช ุดุบุงู ูููุณ.`;
  }
};

// ุงุฎุชุจุงุฑ ุณุฑูุน (ุงุฎุชูุงุฑู - ุงูุณุญ ุงูุณุทุฑ ุฏู ูู ูุด ุนุงูุฒู)
// console.log("Gemini ุฌุงูุฒ ููุชุญููู ูุง ูุญุด!");
